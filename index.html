<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>TVサイズAR（iOS/Android）</title>
  <!-- iOS: Quick Look / Android: WebXR 用に model-viewer を利用 -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{margin:0;height:100%}
    #ui{position:fixed;top:10px;left:10px;right:10px;display:flex;gap:8px;flex-wrap:wrap;
        background:rgba(0,0,0,.55);color:#fff;padding:8px 10px;border-radius:10px;font:14px system-ui}
    #ui select,#ui button{font-size:14px;padding:6px 8px;border-radius:6px;border:0}
    model-viewer{width:100vw;height:100vh;background:transparent}
  </style>
</head>
<body>
  <div id="ui">
    <span>サイズ:</span>
    <select id="size">
      <option value="43">43"</option>
      <option value="50">50"</option>
      <option value="55" selected>55"</option>
      <option value="65">65"</option>
      <option value="75">75"</option>
    </select>
    <button id="openAR">ARで表示</button>
  </div>

  <!-- 表示用ビューワ（iOSはQuick Lookに、AndroidはWebXRに分岐） -->
  <model-viewer id="mv"
    src="assets/tv_16x9_1m.glb"
    ios-src="assets/tv_16x9_55in.usdz"
    ar ar-modes="webxr scene-viewer quick-look"
    camera-controls disable-zoom
    style="--poster-color: transparent;">
    <button slot="ar-button" id="arBtn" style="display:none">AR</button>
  </model-viewer>

  <script>
    const mv = document.getElementById('mv');
    const sel = document.getElementById('size');
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    // サイズ変更 → iOSはUSDZ差し替え、AndroidはGLBスケーリング（GLBは幅1m基準）
    function applySize(){
      const inch = sel.value;
      if(isIOS){
        mv.setAttribute('ios-src', `assets/tv_16x9_${inch}in.usdz`);
      }else{
        const widthM = inchToWidthMeters(+inch); // 16:9の幅に換算
        const s = widthM / 1.0; // GLBが幅1m基準
        mv.scale = `${s} ${s} ${s}`;
      }
    }
    function inchToWidthMeters(inch){
      const widthIn = inch * 16 / Math.sqrt(16*16 + 9*9); // 16:9の幅
      return widthIn * 0.0254;
    }
    sel.addEventListener('change', applySize);
    window.addEventListener('load', applySize);

    // ユーザー操作でARを開く（iOSはQuick Lookが立ち上がりカメラ起動）
    document.getElementById('openAR').addEventListener('click', () => {
      // model-viewer の内部ARボタンを模擬クリック
      mv.activateAR();
    });
  </script>
</body>
</html>
