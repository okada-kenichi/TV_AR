<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
        <title>TV Fit (iOS/Android Hybrid)</title>
        <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
        <style>
            html,
            body {
                margin: 0;
                height: 100%;
            }
            #ui {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: rgba(0, 0, 0, 0.55);
                color: #fff;
                padding: 8px 10px;
                border-radius: 10px;
                font: 14px system-ui;
            }
            #ui input,
            #ui select,
            #ui button {
                font-size: 14px;
                padding: 6px 8px;
                border-radius: 6px;
                border: 0;
            }
            #hint {
                position: fixed;
                bottom: 12px;
                left: 12px;
                right: 12px;
                color: #fff;
                text-align: center;
                text-shadow: 0 1px 2px #000;
            }
            model-viewer {
                width: 100vw;
                height: 100vh;
                background: transparent;
            }
        </style>
    </head>
    <body>
        <div id="ui">
            <span>モード:</span>
            <select id="mode">
                <option value="floor">床に置く</option>
                <option value="wall" selected>壁に掛ける</option>
            </select>

            <span>サイズ:</span>
            <!-- iOS: ここで選んだインチのUSDZに差し替える / Android: 入力でGLBスケール -->
            <select id="preset">
                <option value="43">43"</option>
                <option value="50">50"</option>
                <option value="55" selected>55"</option>
                <option value="65">65"</option>
                <option value="75">75"</option>
            </select>

            <span>（Androidのみ）幅cm:</span>
            <input id="widthCm" type="number" min="30" step="1" value="121" style="width: 80px" />
            <button id="apply">反映</button>
        </div>

        <model-viewer
            id="mv"
            src="assets/tv_16x9_1m.glb"
            ios-src="assets/tv_16x9_55in.usdz"
            ar
            ar-modes="webxr scene-viewer quick-look"
            camera-controls
            disable-zoom
            shadow-intensity="0.6"
            exposure="1.0"
            style="--poster-color: transparent"
        >
            <button slot="ar-button" style="position: absolute; left: 50%; transform: translateX(-50%); bottom: 24px; padding: 10px 16px; border-radius: 10px; border: 0">ARで表示</button>
        </model-viewer>

        <div id="hint">iOSは「ARで表示」でQuick Lookが開きます。壁/床にかざしてタップで配置。</div>

        <script>
            const mv = document.getElementById("mv");
            const presetSel = document.getElementById("preset");
            const widthInput = document.getElementById("widthCm");
            const modeSel = document.getElementById("mode");

            // プリセット → USDZ/GLBの切替
            const usdzMap = (size) => `assets/tv_16x9_${size}in.usdz`;
            // GLBは1m幅を想定（16:9板）。Androidではスケールで任意に拡大縮小
            function setAndroidWidthCM(cm) {
                const widthM = cm / 100;
                const base = 1.0; // GLBの基準幅(1m)
                const s = widthM / base;
                mv.scale = `${s} ${s} ${s}`;
            }

            // iOS/Android判定（簡易）
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

            function apply() {
                const inch = presetSel.value;
                if (isIOS) {
                    // iOS: サイズはUSDZで反映（Quick Look）
                    mv.setAttribute("ios-src", usdzMap(inch));
                } else {
                    // Android: GLBをスケール
                    setAndroidWidthCM(parseFloat(widthInput.value || "121"));
                }

                // 壁/床の違いはユーザー操作でOK（Quick Look/ARが面を自動検出）
                // 補助として"wall"ならモデルの奥行きを薄く、中心を壁面に寄せたい場合はGLB側のピボットで調整
            }

            document.getElementById("apply").addEventListener("click", apply);
            presetSel.addEventListener("change", apply);
            window.addEventListener("load", apply);
        </script>
    </body>
</html>
